<% content_for :title, "H." %>

<div class="max-w-6xl mx-auto">

  <%# Search %>
  <div class="flex items-center gap-4 mb-6">
    <%= form_with url: notes_path, method: :get, local: true, class: "flex-1 flex items-center gap-0" do |f| %>
      <%= f.hidden_field :sort, value: @sort_col %>
      <%= f.hidden_field :dir, value: @sort_dir %>
      <%= f.text_field :q, value: params[:q],
          placeholder: "Search notes...",
          class: "flex-1 border border-black px-3 py-2 text-sm focus:outline-none",
          autocomplete: "off" %>
      <%= f.submit "Search", class: "border border-l-0 border-black px-4 py-2 text-sm hover:bg-black hover:text-white transition-colors cursor-pointer" %>
    <% end %>
    <% if params[:q].present? %>
      <%= link_to "Clear", notes_path(sort: @sort_col, dir: @sort_dir),
          class: "text-sm hover:underline whitespace-nowrap" %>
    <% end %>
  </div>

  <% if @notes.empty? %>
    <p class="text-sm border border-black p-8 text-center">
      <% if params[:q].present? %>
        No notes matching "<%= params[:q] %>".
      <% else %>
        No notes yet. <%= link_to "Create one", new_note_path, class: "underline" %>.
      <% end %>
    </p>
  <% else %>
    <table class="w-full border border-black text-sm">
      <thead>
        <tr class="border-b border-black">
          <th class="text-left px-4 py-3 font-bold tracking-tighter w-full">Title</th>
          <th class="text-left px-4 py-3 font-bold tracking-tighter whitespace-nowrap">
            <%= sort_link "Updated", "updated_at", @sort_col, @sort_dir, params[:q] %>
          </th>
          <th class="text-left px-4 py-3 font-bold tracking-tighter whitespace-nowrap">
            <%= sort_link "Created", "created_at", @sort_col, @sort_dir, params[:q] %>
          </th>
          <th class="px-4 py-3"></th>
        </tr>
      </thead>
      <tbody class="divide-y divide-black">
        <% @notes.each do |note| %>
          <tr>
            <td class="px-4 py-3">
              <%= link_to note.content.lines.first&.strip&.truncate(80) || "(empty)",
                  note_path(note), class: "hover:underline" %>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-gray-500" title="<%= note.updated_at.strftime('%b %d, %Y %H:%M') %>">
              <%= time_ago_in_words(note.updated_at) %> ago
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-gray-500" title="<%= note.created_at.strftime('%b %d, %Y %H:%M') %>">
              <%= time_ago_in_words(note.created_at) %> ago
            </td>
            <td class="px-4 py-3 whitespace-nowrap">
              <div class="flex items-center gap-3">
                <%= link_to "Edit", edit_note_path(note), class: "hover:underline" %>
                <%= button_to "Del", note_path(note), method: :delete,
                    class: "hover:underline bg-transparent border-0 cursor-pointer p-0",
                    data: { turbo_method: :delete, turbo_confirm: "Delete?" } %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div class="flex items-center justify-between mt-3">
      <p class="text-xs text-gray-500"><%= @pagy.count %> note<%= @pagy.count == 1 ? "" : "s" %></p>
      <% if @pagy.pages > 1 %>
        <nav class="flex items-center gap-1 text-sm">
          <% if @pagy.prev %>
            <%= link_to "←", notes_path(page: @pagy.prev, sort: @sort_col, dir: @sort_dir, q: params[:q]),
                class: "border border-black px-2 py-1 hover:bg-black hover:text-white transition-colors" %>
          <% end %>
          <% @pagy.series.each do |item| %>
            <% if item == :gap %>
              <span class="px-2 py-1">…</span>
            <% elsif item == @pagy.page %>
              <span class="border border-black px-2 py-1 bg-black text-white"><%= item %></span>
            <% else %>
              <%= link_to item, notes_path(page: item, sort: @sort_col, dir: @sort_dir, q: params[:q]),
                  class: "border border-black px-2 py-1 hover:bg-black hover:text-white transition-colors" %>
            <% end %>
          <% end %>
          <% if @pagy.next %>
            <%= link_to "→", notes_path(page: @pagy.next, sort: @sort_col, dir: @sort_dir, q: params[:q]),
                class: "border border-black px-2 py-1 hover:bg-black hover:text-white transition-colors" %>
          <% end %>
        </nav>
      <% end %>
    </div>
  <% end %>

</div>
